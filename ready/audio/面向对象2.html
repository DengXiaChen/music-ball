<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>面向对象2</title>
	<style>
	body {position: relative;height: 800px;}
	.music_ball {width: 30px; height: 30px; background: #DDD; border-radius: 100%; overflow: hidden; position: absolute; text-align: center; vertical-align: middle; top: 0px; left: 0px;}
	.music_content {position: absolute;top: 0;left: 0;bottom: 0;right: 0;margin: auto;display: inline-block;text-overflow:ellipsis;width: 80%;height: 114px;color: #E9EAEA;}
	.audio {width: 0;height: 0;}
	.singer {display: inline-block;line-height: 32px;font-size: 14px;}
	.button {width: 50px; height: 50px;line-height: 50px;display: inline-block;cursor: pointer;}
	.song {display: inline-block;line-height: 32px;font-size: 14px;}
	</style>
	<script src="script/move2.js" rel="text/javascript"></script>
	<script>
		window.onload=function(){
			var json=[{"music_URL1":"music/周玥 - 至少还有你.ogg",
			"music_URL2":"music/周玥 - 至少还有你.mp3",
			"song_name":"至少还有你",
			"singer_name":"周玥"},
			{"music_URL1":"music/莫文蔚 - 阴天.ogg",
			"music_URL2":"music/莫文蔚 - 阴天.mp3",
			"song_name":"莫文蔚 - 阴天",
			"singer_name":"莫文蔚"}];
			for(var i in json){
				new CreateBall(json[i]);
			}
		}
		function random(iMin,iMax)
		{
			return(parseInt(Math.random()*(iMax-iMin)+iMin));
		}

		function getStyle(obj,name){
			if(obj.currentStyle){
				return obj.currentStyle[name];
			}else{
				return getComputedStyle(obj,false)[name];
			}
		}

		function CreateBall(json_){

			var _this=this;
			this.music_URL1=json_.music_URL1;
			this.music_URL2=json_.music_URL2;
			this.song_name=json_.song_name;
			this.singer_name=json_.singer_name;

			this.music_ball=document.createElement('div');
			this.music_ball.className="music_ball";

			this.audio=document.createElement('audio')
			this.audio.className="audio";

			this.source1=document.createElement('source');
			this.source1.className="source1";
			this.source1.setAttribute("src",this.music_URL1);

			this.source2=document.createElement('source');
			this.source2.className="source2";
			this.source2.setAttribute("src",this.music_URL2);

			this.audio.appendChild(this.source1);
			this.audio.appendChild(this.source2);
			this.music_ball.appendChild(this.audio);

			this.music_content=document.createElement("div");
			this.music_content.className="music_content";

			this.song=document.createElement("span");
			this.song.className="song";
			this.song.innerHTML=this.song_name;

			this.button=document.createElement("img");
			this.button.className="button";
			this.button.setAttribute("src","img/icon/play.png");

			this.singer=document.createElement("span");
			this.singer.className="singer";
			this.singer.innerHTML=this.singer_name;

			this.music_content.appendChild(this.song);
			this.music_content.appendChild(this.button);
			this.music_content.appendChild(this.singer);

			this.br=document.createElement("br");
			this.music_content.insertBefore(this.br,this.singer);
			this.br=document.createElement("br");
			this.music_content.insertBefore(this.br,this.button);

			this.music_ball.appendChild(this.music_content);
			document.body.appendChild(this.music_ball);

			this.wh=random(150,250);
			startMove(this.music_ball,{"width":this.wh,"height":this.wh});

			// this.music_ball.style.width=this.wh+"px";
			// this.music_ball.style.height=this.wh+"px";
			this.co=random(100,999);
			this.music_ball.style.backgroundColor="#"+this.co;

			this.pw=parseInt(getStyle(this.music_ball.parentNode,"width"));
			this.ph=parseInt(getStyle(this.music_ball.parentNode,"height"));
			this.l=random(0,this.pw-this.wh);
			this.t=random(0,this.ph-this.wh);
			this.music_ball.style.left=this.l+"px";
			this.music_ball.style.top=this.t+"px";

			this.disX=0;
			this.disY=0;
			// this.music_ball.onmousedown=function(ev){
			// 	var ev=ev||event;
			// 	_this.fnDown(ev);
			// 	return false;
			// }

			this.button.onclick=function(ev){
				var ev=ev||event;
				_this.fnClick(ev);
			}
			this.music_ball.onmouseenter=function(ev){
				var ev=ev||event;
				_this.fnMouseenter(ev);
			}
			this.music_ball.onmouseleave=function(ev){
				var ev=ev||event;
				_this.fnMouseleave(ev);
			}
		}

		// CreateBall.prototype.fnDown=function(ev){
		// 	var ev=ev||event;
		// 	var _this=this;
		// 	this.disX=ev.clientX-this.l;
		// 	this.disY=ev.clientY-this.t;
		// 	document.onmousemove=function(ev){
		// 		_this.fnMove(ev);
		// 	};
		// 	document.onmouseup=function(ev){
		// 		_this.fnUp(ev);
		// 	};
		// }

		// CreateBall.prototype.fuMove=function(ev){
		// 	var ev=ev||event;
		// 	this.music_ball.style.left=ev.clientX-this.disX+'px';
		// 	this.music_ball.style.top=ev.clientY-this.disY+'px';
		// }

		// CreateBall.prototype.fnUp=function(ev){
		// 	document.onmousemove=null;
		// 	document.onmouseup=null;
		// }

		CreateBall.prototype.fnClick=function(ev){
			var ev=ev||event;
			var _this=this;
			var aBalls=document.getElementsByClassName("music_ball");
			for(var i=0;i<aBalls.length;i++){
				aBalls[i].setAttribute("id","");
				aBalls[i].style.zIndex=0;
			}
			this.music_ball.setAttribute("id","active");
			this.music_ball.style.zIndex=99;
			if(this.audio.paused){
				this.audio.play();
				this.button.setAttribute("src","img/icon/pause.png")
			}else{
				this.audio.pause();
				this.button.setAttribute("src","img/icon/play.png")
			}
		}
		CreateBall.prototype.fnMousedown=function(ev){

		}
		CreateBall.prototype.fnMouseenter=function(ev){
			var ev=ev||event;
			var _this=this;
			startMove(this.music_ball,{"width":this.wh+100,"height":this.wh+100,"top":this.t-50,"left":this.l-50});
		}
		CreateBall.prototype.fnMouseleave=function(ev){
			var ev=ev||event;
			var _this=this;
			startMove(this.music_ball,{"width":this.wh,"height":this.wh,"top":this.t,"left":this.l});
		}
	

</head>
<body>
	
</body>
</html>